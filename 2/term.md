## 2. 基础篇DDD术语

```
1. 通用语言
2. 领域专家
3. 领域、子域、核心域、通用域和支撑域
4. 限界上下文
5. 实体和值对象
6. 仓储
7. 聚合和聚合根
8. 领域服务
9. 领域事件
10. 应用程序.用户界面
11. 应用程序.应用服务

```
#### 1. 通用语言

**什么是通用语言**
```
通过团队交流达成共识，能够简单、清晰、准确描述业务涵义和规则的语言就是通用语言
```

**如何建立通用语言**
```
通过团队交流，达成共识就建立了通用语言
```


#### 2. 领域专家

**什么是领域专家**
```
精通业务的（任何）人。
列如：产品经理、业务员或者老板
```

### 3. 领域、子域、核心域、通用域和支撑域

```
领域：一种特定的范围或区域，用来限定业务边界和范围的，领域可以表示整个业务系统

子域：领域可以进一步划分为子领域，我们把划分出来的多个子领域称为子域（领域下包含的子领域就是子域）

核心域：决定产品或者说公司核心竞争力的子域就是核心域，它也是业务成功的主要促成因数。

通用域：如同时被多个子域使用的通用功能的子域就是通用域

支撑子域：如同时被多个子域使用的通用功能的子域就是通用域
```

**如何划分DDD领域？**

```
领域划分的核心思想就是将问题域逐级细分，来降低业务理解和系统实现的复杂度。通过领域细分，逐步缩小需要解决的问题域，构建合适的领域模型。
通俗的说，就是将应用系统以业务划分，将业务问题逐步细分、重组后就划分出合适领域。
```



### 4. 限界上下文

```
限界：领域的边界
上下文：语义环境
限界上下文就是用来确定语义环境所在的领域边界。
通俗的讲限界上下文是一个显示的边界，领域模型便存在于这个边界之内，它就是用来为领域提供上下文语义环境，保证在边界内，通用语言中的所有术语和词组（业务相关对象）都有确切的含义
，没有二义性
```

**限界上下文的作用**
```
1、主要是为了消除通用语言在不同领域中的歧义或者说是限制通用语言的使用范围。
2、是划分领域的重要依据
3、通用语言必须与限界上下文配合使用才有意义
```

**如何划分限界上下文**
```
首先把业务划分成粗粒度的领域，使用通用语言来描述所有的业务术语，每个业务术语必须清晰不能存在二义性。
这样就能确保划分出正确的限界上下文。然后使用界限上下文，确定每个业务领域和边界。
```

### 5. 实体和值对象

**实体**
```
实体：拥有唯一标识符，并且标识符在经历各种状态变更后任然能保持一致
```

**值对象**
```
值对象：通过对象的属性来识别的对象。如果两个对象所有属性的值都相同，
我们会认为它们是同一个对象，那么就可以把这种对象设计为值对象
```

### 6. 仓储

```
资源仓储封装了基础设施来提供查询和持久化聚合操作
```

### 7. 聚合和聚合根

**聚合**
```
聚合就是由业务和逻辑紧密关联的实体和值对象组合而成，聚合是数据修改和持久化的基本单元。
聚合就是根据业务的需要，将一组相关对象的组合，它作为数据修改和访问的基本单元

```

**聚合的目的**
```
聚合根的主要目的是为了避免由于复杂数据模型缺少统一的业务规则控制，而导致聚合、实体之间数据不一致性的问题。
```

**聚合的一些设计原则**

```
1. 在一致性边界内建模真正的不变条件
  聚合用来封装真正的不变性，而不是简单地将对象组合在一起。聚合内有一套不变的业务规则，
  各实体和值对象按照统一的业务规则运行，实现对象数据的一致性，边界之外的任何东西都与该聚合无关，
  这就是聚合能实现业务高内聚的原因。
  
2. 设计小聚合
  如果聚合设计得过大，聚合会因为包含过多的实体，导致实体之间的管理过于复杂，
  高频操作时会出现并发冲突或者数据库锁，最终导致系统可用性变差。
  而小聚合设计则可以降低由于业务过大导致聚合重构的可能性，让领域模型更能适应业务的变化。
  
3. 通过唯一标识引用其它聚合
  聚合之间是通过关联外部聚合根 ID 的方式引用，而不是直接对象引用的方式。
  外部聚合的对象放在聚合边界内管理，容易导致聚合的边界不清晰，也会增加聚合之间的耦合度。
  
4. 在边界之外使用最终一致性
  聚合内数据强一致性，而聚合之间数据最终一致性。在一次事务中，最多只能更改一个聚合的状态。
  如果一次业务操作涉及多个聚合状态的更改，应采用领域事件的方式异步修改相关的聚合，
  实现聚合之间的解耦（相关内容我会在领域事件部分详解）。
  
5. 通过应用层实现跨聚合的服务调用
  为实现微服务内聚合之间的解耦，以及未来以聚合为单位的微服务组合和拆分，
  应避免跨聚合的领域服务调用和跨聚合的数据库表关联。
  
  上面的这些原则是 DDD 的一些通用的设计原则，还是那句话：“适合自己的才是最好的。
  ”在系统设计过程时，你一定要考虑项目的具体情况，如果面临使用的便利性、高性能要求、
  技术能力缺失和全局事务管理等影响因素，这些原则也并不是不能突破的，总之一切以解决实际问题为出发点。
```

### 8. 领域服务

```
领域服务表示一个无状态处理业务逻辑的操作，它用于实现特定于某个领域的任务(业务逻辑操作)。
领域服务负责表达业务概念，业务状态信息以及业务规则，是业务软件的核心。
当某个操作不适合放在聚合、实体、值对象上时，最好的方式便是使用领域服务了。

领域服务是用来协调领域对象完成某个操作，用来处理业务逻辑的，它本身是一个行为，所以是无状态的。状态由领域对象（具有状态和行为）保存。
```

**领域服务设计原则**

```
1. 执行一个显著的业务操作过程
2. 对领域对象进行转换
3. 以多个领域对象作为输入进行计算，结果产生一个值对象

```

**领域服务注意事项**
```
请不要过于倾向于将一个领域概念建模成领域服务，而是只有必要的时候才这么做。
过渡的使用领域服务导致所有的业务逻辑都位于领域服务中，而不是实体和值对象中。
```


### 9. 领域事件

```
领域事件用来表示领域中发生的事。

```

**领域事件特点**

```
一个领域事件将导致进一步的业务操作，在实现业务解耦的同时，还有助于形成完整的业务闭环。
但是并不是所有发生过的事情都可以成为领域事件。一个领域事件必须对业务有价值。
```

**为什么需要领域事件**

```
领域事件也是一种基于事件的架构（EDA）。事件架构的好处可以把处理的流程解耦，实现系统可扩展性，提高主业务流程的内聚性。
```



**如何设别领域事件**

```
我们要捕捉业务、需求人员或领域专家口中的关键词：
“当......”
“如果发生......，则......”
“当......的时候，请通知我”
“发生......时”
在这些场景中，如果发生某种事件后，会触发进一步的操作，那么这个事件很可能就是领域事件。
```


### 10. 应用程序.应用服务

```
应用服务负责展现层与领域层之间的协调，协调业务对象来执行特定的应用程序任务。它不包含业务逻辑。
应用服务负责编排和转发，它本身只负责处理业务用例的执行顺序以及结构的拼装。
```
